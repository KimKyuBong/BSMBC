# ğŸ“– ì‚¬ìš© ë°©ë²• (ìµœì‹ )

> ë¼ì¦ˆë² ë¦¬íŒŒì´ + Docker í™˜ê²½ ê¸°ì¤€

---

## ğŸ¯ ë°©ì†¡ ì‹œìŠ¤í…œ ì‚¬ìš©ë²•

### 1. ì‹œìŠ¤í…œ ì‹œì‘

#### Docker ì‚¬ìš© (ê¶Œì¥)
```bash
cd /home/bmbc/project/BSMBC
sudo docker compose up -d
```

#### ì§ì ‘ ì‹¤í–‰
```bash
cd /home/bmbc/project/BSMBC
python3 main.py
```

---

### 2. ì›¹ UI ì ‘ì†

ë¸Œë¼ìš°ì €ì—ì„œ `http://ë¼ì¦ˆë² ë¦¬íŒŒì´IP:8000` ì ‘ì†

---

## ğŸ“» ë°©ì†¡í•˜ê¸°

### A. í…ìŠ¤íŠ¸ ë°©ì†¡ (TTS)

#### ì›¹ UI
1. "ë°©ì†¡" ë©”ë‰´ ì„ íƒ
2. "í…ìŠ¤íŠ¸ ë°©ì†¡" íƒ­
3. ë°©ì†¡í•  í…ìŠ¤íŠ¸ ì…ë ¥
4. ëŒ€ìƒ êµì‹¤ ì„ íƒ (ì˜ˆ: 101, 102, 201)
5. "í”„ë¦¬ë·° ìƒì„±" ë²„íŠ¼
6. ë¯¸ë¦¬ë“£ê¸° í›„ "ìŠ¹ì¸" ë²„íŠ¼

#### Python ì½”ë“œ
```python
import requests

# 1. í”„ë¦¬ë·° ìƒì„±
response = requests.post(
    'http://localhost:8000/api/broadcast/text',
    data={
        'text': 'ì ì‹¬ì‹œê°„ì…ë‹ˆë‹¤',
        'target_rooms': '101,102,103,104',  # 1í•™ë…„ ì „ì²´
        'language': 'ko',
        'auto_off': 'true'
    }
)

preview_id = response.json()['preview_id']

# 2. í”„ë¦¬ë·° ìŠ¹ì¸
requests.post(
    f'http://localhost:8000/api/broadcast/preview/approve/{preview_id}'
)
```

### B. ì˜¤ë””ì˜¤ íŒŒì¼ ë°©ì†¡

#### ì›¹ UI
1. "ë°©ì†¡" ë©”ë‰´ ì„ íƒ
2. "ì˜¤ë””ì˜¤ ë°©ì†¡" íƒ­
3. ì˜¤ë””ì˜¤ íŒŒì¼ ì—…ë¡œë“œ (MP3, WAV ë“±)
4. ëŒ€ìƒ êµì‹¤ ì„ íƒ
5. "í”„ë¦¬ë·° ìƒì„±" ë²„íŠ¼
6. ë¯¸ë¦¬ë“£ê¸° í›„ "ìŠ¹ì¸" ë²„íŠ¼

#### curl ëª…ë ¹
```bash
curl -X POST "http://localhost:8000/api/broadcast/audio" \
  -F "audio_file=@/path/to/audio.mp3" \
  --data-urlencode "target_rooms=101,102,201" \
  --data-urlencode "auto_off=true"
```

---

## ğŸ›ï¸ ì¥ì¹˜ ì œì–´

### A. ê°œë³„ ì¥ì¹˜

#### CLI
```bash
# 1í•™ë…„ 1ë°˜ ì¼œê¸°
python3 app/utils/cli.py control "1-1" --on

# ëª¨ë‘ 12 ë„ê¸°
python3 app/utils/cli.py control "ëª¨ë‘ 12" --off
```

#### API
```python
import requests

requests.post(
    'http://localhost:8000/api/device/matrix/turn-on',
    json={'row': 0, 'col': 0}  # 1í–‰ 1ì—´ = 1-1
)
```

### B. ê·¸ë£¹ ì œì–´

#### CLI
```bash
# 1í•™ë…„ ì „ì²´ ì¼œê¸°
python3 app/utils/cli.py group grade1 --on

# 2í•™ë…„ ì „ì²´ ì¼œê¸°
python3 app/utils/cli.py group grade2 --on

# ëª¨ë“  êµì‹¤ ë„ê¸°
python3 app/utils/cli.py group all --off
```

#### ì‚¬ìš© ê°€ëŠ¥í•œ ê·¸ë£¹
- `grade1` - 1í•™ë…„ ì „ì²´ (1-1, 1-2, 1-3, 1-4)
- `grade2` - 2í•™ë…„ ì „ì²´ (2-1, 2-2, 2-3, 2-4)
- `grade3` - 3í•™ë…„ ì „ì²´ (3-1, 3-2, 3-3, 3-4)
- `all` - ì „ì²´ êµì‹¤ (12ê°œ)

---

## ğŸ“… ì˜ˆì•½ ë°©ì†¡

### ìŠ¤ì¼€ì¤„ ì¶”ê°€

#### CLI
```bash
# ë§¤ì¼ ì˜¤ì „ 8ì‹œ 30ë¶„ì— 1í•™ë…„ ì¼œê¸°
python3 app/utils/cli.py schedule --add \
  --time 08:30 \
  --days "Monday,Tuesday,Wednesday,Thursday,Friday" \
  --target 0 \
  --state 1
```

#### ì›¹ UI
1. "ìŠ¤ì¼€ì¤„" ë©”ë‰´ ì„ íƒ
2. "ìŠ¤ì¼€ì¤„ ì¶”ê°€" ë²„íŠ¼
3. ì‹œê°„, ìš”ì¼, ëŒ€ìƒ, ë™ì‘ ì„¤ì •
4. "ì €ì¥" ë²„íŠ¼

### ìŠ¤ì¼€ì¤„ ê´€ë¦¬

```bash
# ìŠ¤ì¼€ì¤„ ëª©ë¡ í™•ì¸
python3 app/utils/cli.py schedule --list

# ìŠ¤ì¼€ì¤„ ì‚­ì œ (ë²ˆí˜¸ 1ë²ˆ)
python3 app/utils/cli.py schedule --delete 1

# ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
python3 app/utils/cli.py schedule --start

# ìŠ¤ì¼€ì¤„ëŸ¬ ì¤‘ì§€
python3 app/utils/cli.py schedule --stop
```

---

## ğŸ”§ ì„¤ì • ë³€ê²½

### ì¥ì¹˜ ë°°ì¹˜ ìˆ˜ì •

`config/device_matrix.json` íŒŒì¼ ìˆ˜ì •:

```json
[
  ["1-1", "1-2", "1-3", "1-4", "ì¥ì¹˜5", ...],
  ["3-1", "3-2", "3-3", "3-4", ...],
  ["êµí–‰ì—°íšŒ", "êµì‚¬ì—°êµ¬", ..., "ëª¨ë‘ 12", ...],
  ["ë³¸ê´€1ì¸µ", "ìœµí•©1ì¸µ", ..., "ê°•ë‹¹", "ë°©ì†¡ì‹¤", ...]
]
```

**ìˆ˜ì • í›„**: ì„œë²„ ìë™ ì¬ë¡œë“œ (ê°œë°œ ëª¨ë“œ) ë˜ëŠ” ì¬ì‹œì‘

**ê·¸ë£¹ ìë™ ìƒì„±**:
- `1í•™ë…„ì „ì²´`, `2í•™ë…„ì „ì²´`, `3í•™ë…„ì „ì²´` ìë™ ê°ì§€
- `ì „ì²´êµì‹¤` (í•™ë…„-ë°˜ í˜•ì‹ ëª¨ë‘)
- `ì‹¤ì œì¥ì¹˜` (ì „ì²´)

### ë„¤íŠ¸ì›Œí¬ ì„¤ì •

ë°©ì†¡ ì„œë²„ IP/Port ë³€ê²½:

#### í™˜ê²½ ë³€ìˆ˜
```bash
TARGET_IP=192.168.0.100 TARGET_PORT=23000 python3 main.py
```

#### Docker
```bash
# docker-compose.yml ìˆ˜ì •
environment:
  - TARGET_IP=192.168.0.100
  - TARGET_PORT=23000
```

---

## ğŸ¨ ê³ ê¸‰ ì‚¬ìš©ë²•

### ì˜¤ë””ì˜¤ ì •ê·œí™” ì„¤ì •

`app/core/config.py`:

```python
DEFAULT_TARGET_DBFS = -12.0  # ëª©í‘œ ë³¼ë¥¨ (dBFS)
```

### ì‹œì‘/ë ì‹ í˜¸ìŒ ë³€ê²½

`data/start.mp3`, `data/end.mp3` íŒŒì¼ êµì²´

### ë³´ì•ˆ ì„¤ì •

`config/security_config.json`:

```json
{
  "totp_enabled": true,        # TOTP 2ë‹¨ê³„ ì¸ì¦
  "ip_check_enabled": true,    # IP ê²€ì‚¬
  "allowed_ips": [
    "192.168.0.0/16",
    "127.0.0.1/32"
  ]
}
```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### ì‹œìŠ¤í…œ ìƒíƒœ

```bash
# CLI
python3 app/utils/cli.py status

# API
curl http://localhost:8000/api/status
```

### ë¡œê·¸ í™•ì¸

#### Docker
```bash
sudo docker compose logs -f
```

#### ì§ì ‘ ì‹¤í–‰
```bash
tail -f logs/app_$(date +%Y%m%d).log
```

### í ìƒíƒœ í™•ì¸

ì›¹ UI â†’ "í í˜„í™©" ë©”ë‰´

---

## ğŸ›‘ ì‹œìŠ¤í…œ ì¤‘ì§€

### Docker
```bash
sudo docker compose down
```

### ì§ì ‘ ì‹¤í–‰
```bash
pkill -f "python3 main.py"
```

---

## ğŸ’¡ íŒ

### 1. ë¹ ë¥¸ í…ŒìŠ¤íŠ¸
```bash
# ëª¨ë‘ 12ì— í…ŒìŠ¤íŠ¸ ë°©ì†¡
curl -X POST "http://localhost:8000/api/broadcast/text" \
  --data-urlencode "text=í…ŒìŠ¤íŠ¸" \
  --data-urlencode "target_rooms=315" \
  --data-urlencode "language=ko" \
  --data-urlencode "auto_off=true"
```

### 2. ì¼ê´„ ì œì–´
```python
# ì—¬ëŸ¬ êµì‹¤ ë™ì‹œ ì œì–´
import requests

# 1í•™ë…„ ì „ì²´ + 2í•™ë…„ 1ë°˜
requests.post('http://localhost:8000/api/device/matrix/set-active-rooms',
    json={'room_numbers': [101, 102, 103, 104, 201]})
```

### 3. ì¥ì¹˜ ìƒíƒœ ì¡°íšŒ
```bash
curl http://localhost:8000/api/device-matrix/
```

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [README.md](README.md) - í”„ë¡œì íŠ¸ ê°œìš”
- [DOCKER_GUIDE.md](DOCKER_GUIDE.md) - Docker ìƒì„¸ ê°€ì´ë“œ
- [INSTALLATION_COMPLETE.md](INSTALLATION_COMPLETE.md) - ì„¤ì¹˜ ê°€ì´ë“œ
- API ë¬¸ì„œ: http://ë¼ì¦ˆë² ë¦¬íŒŒì´IP:8000/docs

---

**ì¦ê±°ìš´ ë°©ì†¡ ë˜ì„¸ìš”! ğŸ™ï¸**

