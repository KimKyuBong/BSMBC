# BSMBC 방송 시스템 완전 명세서

## 📋 시스템 개요

BSMBC (Broadcast System for Multiple Building Control)는 학교 건물 내 다중 방송 시스템입니다. 텍스트와 오디오 방송을 지원하며, 프리뷰 시스템을 통해 방송 전 확인 및 승인 과정을 거칩니다.

---

## 🏗️ 시스템 아키텍처

### 핵심 구성 요소
```
BSMBC/
├── app/                    # FastAPI 웹 애플리케이션
│   ├── api/routes/        # API 엔드포인트
│   ├── core/              # 핵심 설정 및 보안
│   ├── models/            # 데이터 모델
│   ├── services/          # 비즈니스 로직
│   └── templates/         # 웹 템플릿
├── data/                  # 데이터 저장소
│   ├── audio/            # 오디오 파일
│   └── config/           # 설정 파일
├── ffmpeg/               # FFmpeg 실행 파일
└── docs/                 # 문서
```

---

## 🎯 주요 기능

### 1. 텍스트 방송
- TTS를 통한 텍스트를 음성으로 변환
- 한국어/영어 지원
- 프리뷰 시스템으로 사전 확인

### 2. 오디오 방송
- MP3, WAV 파일 직접 방송
- 프리뷰 시스템으로 사전 확인

### 3. 프리뷰 시스템
- 방송 전 미리 들어보기
- 시작/끝 신호음 포함
- 승인/거부 기능

### 4. 방송 큐 관리
- 순차적 방송 처리
- 큐 상태 모니터링
- 우선순위 관리

### 5. 장치 매트릭스 관리
- 방별 장치 매핑
- 장치 상태 모니터링
- 실시간 제어

---

## 🔧 기술 스택

### 백엔드
- **FastAPI**: 웹 API 프레임워크
- **Python 3.8+**: 메인 프로그래밍 언어
- **pydub**: 오디오 처리
- **gTTS**: Google Text-to-Speech
- **pyttsx3**: 로컬 TTS 엔진

### 외부 도구
- **FFmpeg**: 오디오 파일 처리
- **ffprobe**: 오디오 파일 분석

### 네트워크
- **UDP**: 장치 통신
- **HTTP/HTTPS**: API 통신
- **WebSocket**: 실시간 상태 업데이트

---

## 📡 API 명세

### 기본 URL
```
http://localhost:8000
```

### 인증
- **TOTP**: 2단계 인증
- **API Key**: 클라이언트 인증

---

## 🎵 오디오 처리 시스템

### 신호음 구성
- **시작 신호음**: 도미솔도 (start.mp3)
- **끝 신호음**: 도솔미도 (end.mp3)

### 오디오 파일 형식
- **입력**: MP3, WAV, OGG
- **출력**: MP3 (128kbps, 44.1kHz)
- **프리뷰**: MP3 (신호음 포함)

### TTS 설정
- **한국어**: gTTS (Google TTS)
- **영어**: pyttsx3 (로컬 TTS)
- **음성 품질**: 고품질 설정

---

## 🏢 장치 매트릭스 시스템

### 장치 ID 규칙
```
{건물번호}-{층수}-{방번호}
예: 3-15 (3층 15호실)
```

### 지원 장치
- **스피커**: 음성 방송
- **LED 패널**: 텍스트 표시
- **제어 장치**: 전원 제어

### 장치 상태
- **ONLINE**: 정상 작동
- **OFFLINE**: 연결 끊김
- **BUSY**: 방송 중
- **ERROR**: 오류 상태

---

## 🔒 보안 시스템

### 인증 방식
1. **TOTP 토큰**: 30초마다 갱신
2. **API 키**: 클라이언트 식별
3. **세션 관리**: JWT 토큰

### 보안 설정
```json
{
  "security_enabled": true,
  "totp_required": true,
  "api_key_required": true,
  "rate_limiting": true,
  "max_requests_per_minute": 60
}
```

---

## 📊 모니터링 시스템

### 실시간 모니터링
- **장치 상태**: 온라인/오프라인
- **방송 상태**: 진행 중/대기/완료
- **시스템 리소스**: CPU, 메모리, 네트워크

### 로그 시스템
- **방송 로그**: 모든 방송 기록
- **오류 로그**: 시스템 오류
- **보안 로그**: 인증 시도

---

## 🚀 배포 가이드

### Windows 서비스 설치
```bash
# 서비스 설치
python windows_service.py install

# 서비스 시작
python windows_service.py start

# 서비스 중지
python windows_service.py stop
```

### 수동 실행
```bash
# 개발 서버
python main.py

# 프로덕션 서버
python production_server.py
```

---

## 🧪 테스트 시스템

### 단위 테스트
- **API 테스트**: 엔드포인트 기능
- **오디오 테스트**: TTS 및 파일 처리
- **네트워크 테스트**: 장치 통신

### 통합 테스트
- **전체 워크플로우**: 방송 요청 → 프리뷰 → 승인 → 방송
- **성능 테스트**: 동시 요청 처리
- **부하 테스트**: 대용량 파일 처리

---

## 📈 성능 지표

### 응답 시간
- **API 응답**: 평균 200ms
- **프리뷰 생성**: 평균 1초
- **TTS 변환**: 평균 2초

### 처리량
- **동시 방송**: 최대 10개
- **큐 처리**: 초당 1개
- **파일 업로드**: 최대 50MB

### 안정성
- **가동률**: 99.9%
- **오류율**: 0.1% 미만
- **복구 시간**: 30초 이내

---

## 🔧 유지보수

### 일일 점검
- [ ] 장치 상태 확인
- [ ] 로그 파일 정리
- [ ] 디스크 공간 확인

### 주간 점검
- [ ] 성능 모니터링
- [ ] 보안 업데이트
- [ ] 백업 확인

### 월간 점검
- [ ] 시스템 업데이트
- [ ] 하드웨어 점검
- [ ] 사용자 권한 검토

---

## 📚 사용자 가이드

### 관리자
1. **시스템 설정**: 장치 매트릭스, 보안 설정
2. **사용자 관리**: 권한 부여, API 키 발급
3. **모니터링**: 실시간 상태 확인

### 일반 사용자
1. **방송 요청**: 텍스트/오디오 업로드
2. **프리뷰 확인**: 미리 들어보기
3. **승인/거부**: 최종 결정

---

## 🆘 문제 해결

### 일반적인 문제
1. **FFmpeg 오류**: 경로 설정 확인
2. **TTS 실패**: 인터넷 연결 확인
3. **장치 연결 실패**: 네트워크 설정 확인

### 로그 확인
```bash
# 실시간 로그 확인
tail -f logs/broadcast.log

# 오류 로그 확인
grep "ERROR" logs/broadcast.log
```

---

## 📞 지원

### 기술 지원
- **이메일**: support@bsmbc.com
- **전화**: 02-1234-5678
- **문서**: docs/ 디렉토리

### 긴급 연락처
- **시스템 관리자**: admin@bsmbc.com
- **보안 담당자**: security@bsmbc.com

---

*문서 버전: 2.0*  
*최종 업데이트: 2025-06-28*  
*작성자: AI Assistant*  
*검토자: 시스템 관리자* 